@using Hotel.Models
@model HomeVM
<!-- Hidden Sidebar -->
<section class="hidden-bar">
    <div class="inner-box text-center">
        <div class="cross-icon"><span class="fa fa-times"></span></div>
        <div class="title">
            <h4>Get Appointment</h4>
        </div>

        <!--Appointment Form-->
        <div class="appointment-form">
            <form method="post" action="contact.html">
                <div class="form-group">
                    <input type="text" name="text" value="" placeholder="Name" required>
                </div>
                <div class="form-group">
                    <input type="email" name="email" value="" placeholder="Email Address" required>
                </div>
                <div class="form-group">
                    <textarea placeholder="Message" rows="5"></textarea>
                </div>
                <div class="form-group">
                    <button type="submit" class="theme-btn">Submit now</button>
                </div>
            </form>
        </div>

        <!--Social Icons-->
        <div class="social-style-one">
            <a href="#"><i class="fab fa-twitter"></i></a>
            <a href="#"><i class="fab fa-facebook-f"></i></a>
            <a href="#"><i class="fab fa-instagram"></i></a>
            <a href="#"><i class="fab fa-pinterest-p"></i></a>
        </div>
    </div>
</section>
<!--End Hidden Sidebar -->
<!-- Page Banner Start -->
<section class="main-slider-area bgc-black-with-lighting rel z-1">
    <div class="main-slider-active">
        @foreach (var item in Model.Sliders)
        {
            <div class="slider-item">
                <div class="container">
                    <div class="row justify-content-end align-items-center">
                        <div class="col-xl-3">
                            <div class="slider-content">
                                <span class="sub-title"><i class="fal fa-arrow-right"></i> Welcome to Caspian Horizon</span>
                                <h1>@item.Title</h1>
                            </div>
                        </div>
                        <div class="col-xl-8">
                            <div class="slider-image">
                                <img src="@Url.Content("~/assets/imgs/" + item.ImageUrl)" alt="Slider">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-xl-10">
                <div class="main-slider-dots"></div>
            </div>
        </div>
    </div>
    <div class="slider-shapes">
        <img class="shape circle-half" src="@Url.Content("~/assets/images/shapes/slider-circle-half.png")" alt="Shape">
        <img class="shape circle" src="@Url.Content("~/assets/images/shapes/slider-circle.png")" alt="Shape">
    </div>
</section>
<!-- Page Banner End -->
<!-- Rooms Area start -->
<section class="rooms-area pt-130 rpt-100 pb-100 rpb-70 rel z-2">
    <!-- Search Filter and Features Start -->
    <div class="search-and-features-area pb-50 rpb-20 rel z-1">
        <div class="container container-1550">
            <div class="search-filter-inner rel z-2">
                <div class="section-title text-white mb-20 wow fadeInUp delay-0-2s">
                    <h3>Search and Sort</h3>
                </div>
                <div class="filter-item wow fadeInUp delay-0-3s">
                    <input type="text" id="searchInput" placeholder="Search Room..." onkeyup="searchRooms()">
                </div>
                <div class="filter-item wow fadeInUp delay-0-3s">
                    <a asp-action="Index" class="btn btn-primary btn-lg">Show all Rooms <i class="fal fa-arrow-right"></i></a>
                </div>
                <div class="filter-item wow fadeInUp delay-0-3s">
                    <select id="sortOptions" onchange="sortRooms()">
                        <option value="default">Sort by</option>
                        <option value="nameAsc">Name: A to Z</option>
                        <option value="nameDesc">Name: Z to A</option>
                        <option value="ratingAsc">Rating: Low to High</option>
                        <option value="ratingDesc">Rating: High to Low</option>
                    </select>
                </div>
            </div>

        </div>
    </div>
    <!-- Search Filter and Features End -->
    <div class="container">
        <div class="row" id="roomsContainer">
            @foreach (var item in Model.Rooms)
            {
                <div class="col-xl-4 col-md-6 room-item-container">
                    <div class="room-item wow fadeInUp delay-0-2s">
                        <div class="image">
                            @if (item.Images != null && item.Images.Any())
                            {
                                <img src="@Url.Content("~/assets/imgs/" + item.Images.First().Url)" alt="Room">
                            }
                            else
                            {
                                <img src="~/assets/imgs/default-image.jpg" alt="Room">
                            }
                            <a class="category" href="room-grid.html">
                                @if (item.Category != null)
                                {
                                    @item.Category.CategoryName
                                }
                            </a>
                        </div>
                        <div class="content">
                            <h4><a href="room-details.html">@item.Name</a></h4>
                            <ul class="blog-meta">
                                <li>
                                    <i class="far fa-bed-alt"></i>
                                    <a href="#">Adults: @item.Beds</a>
                                </li>
                                <li>
                                    <p>
                                        Rating:
                                        @for (int i = 0; i < item.Rating; i++)
                                        {
                                            <i class="fa fa-star"></i>
                                        }
                                    </p>
                                </li>
                            </ul>
                            <p>@item.Description</p>
                            <p class="p-3 rounded bg-dark " style="color:orange; font-size:1rem">@item.RoomStatus.StatusName</p>
                            <div class="price">Price <span>$@item.Price</span>/per night</div>
                        </div>
                        <a class="theme-btn style-two" asp-action="Details" asp-route-id="@item.Id">Details<i class="fal fa-angle-right"></i></a>
                    </div>
                </div>
            }
        </div>
    </div>
</section>
<!-- Rooms Area end -->
@section Scripts {
    <script>
        async function searchRooms() {
            const query = document.getElementById('searchInput').value.trim();
            let response;

            if (query.length > 0) {
                response = await fetch(`/Room/Search?query=${encodeURIComponent(query)}`);
            } else {
                response = await fetch(`/Room/All`);
            }

            const rooms = await response.json();
            displayRooms(rooms);
            sortRooms(); 
        }

        function sortRooms() {
            const sortOption = document.getElementById('sortOptions').value;
            const roomsContainer = document.getElementById('roomsContainer');
            let rooms = Array.from(roomsContainer.children);

            rooms = rooms.map(roomElement => {
                const name = roomElement.querySelector('.content h4 a').innerText;
                const rating = roomElement.querySelectorAll('.fa-star').length;
                const beds = roomElement.querySelector('.blog-meta li a').innerText.split(': ')[1];
                const price = roomElement.querySelector('.price span').innerText.replace('$', '');
                const category = roomElement.querySelector('.category').innerText.trim();
                const roomStatus = roomElement.querySelector('.bg-dark').innerText.trim();

                return {
                    element: roomElement,
                    name,
                    rating,
                    beds: parseInt(beds),
                    price: parseFloat(price),
                    category,
                    roomStatus
                };
            });

            if (sortOption === "nameAsc") {
                rooms.sort((a, b) => a.name.localeCompare(b.name));
            } else if (sortOption === "nameDesc") {
                rooms.sort((a, b) => b.name.localeCompare(a.name));
            } else if (sortOption === "ratingAsc") {
                rooms.sort((a, b) => a.rating - b.rating);
            } else if (sortOption === "ratingDesc") {
                rooms.sort((a, b) => b.rating - a.rating);
            }

            roomsContainer.innerHTML = '';
            rooms.forEach(room => roomsContainer.appendChild(room.element));
        }

        function displayRooms(rooms) {
            const roomsContainer = document.getElementById('roomsContainer');
            roomsContainer.innerHTML = '';

            rooms.forEach(item => {
                const roomElement = document.createElement('div');
                roomElement.classList.add('col-xl-4', 'col-md-6', 'room-item-container');
                roomElement.innerHTML = `
                                            <div class="room-item wow fadeInUp delay-0-2s">
                                                <div class="image">
                                                    <img src="@Url.Content("~/assets/imgs/${item.imageUrl}")" alt="Room">
                                                            <a class="category" href="room-grid.html">${item.categoryName || ''}</a>
                                                </div>
                                                <div class="content">
                                                    <h4><a href="room-details.html">${item.name}</a></h4>
                                                    <ul class="blog-meta">
                                                        <li>
                                                            <i class="far fa-bed-alt"></i>
                                                            <a href="#">Adults: ${item.beds}</a>
                                                        </li>
                                                        <li>
                                                            <p>Rating: ${'★'.repeat(item.rating)}</p>
                                                        </li>
                                                    </ul>
                                                    <p>${item.description}</p>
                                                                    <p class="p-3 rounded bg-dark" style="color:orange; font-size:1rem">${item.roomstatus}</p>
                                                    <div class="price">Price <span>$${item.price}</span>/per night</div>
                                                </div>
                                                                <a class="theme-btn style-two" href="room/details/${item.id}">Book Now <i class="fal fa-angle-right"></i></a>
                                            </div>
                                        `;
                roomsContainer.appendChild(roomElement);
            });
        }

        window.onload = function () {
            sortRooms();
        }
    </script>
}

