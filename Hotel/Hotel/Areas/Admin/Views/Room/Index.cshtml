@model IEnumerable<GetRoomAdminVM>

@{
	ViewData["Title"] = "Room List";
}


<div class="page-content">
	<div class="card-body p-4">
		<h2>Room List</h2>
		<div style="display:flex; justify-content:flex-end">
			<a asp-action="Create" class="btn btn-primary">Create</a>
		</div>
		<table class="table table-bordered">
			<thead>
				<tr>
					<th>Id</th>
					<th>Room Number</th>
					<th>Name</th>
					<th>Description</th>
					<th>Price</th>
					<th>Check-In Time</th>
					<th>Category</th>
					<th>Room Status</th>
					<th>Rating</th>
					<th>Beds</th>
					<th>Bathrooms</th>
					<th>Actions</th>
				</tr>
			</thead>
			<tbody>
				@foreach (var room in Model)
				{
					<tr>
						<td>@room.Id</td>
						<td>@room.RoomNumber</td>
						<td>@room.Name</td>
						<td>@room.Description</td>
						<td>@room.Price</td>
						<td>@room.CheckIn.ToString("HH:mm")</td>
						<td>@room.CategoryName</td>
						<td>@room.RoomStatusName</td>
						<td>@room.Rating</td>
						<td>@room.Beds</td>
						<td>@room.Bathrooms</td>
						<td class="border-bottom-0">
							<a class="btn btn-danger delete" category-id="@room.Id" href="#">Delete</a>
							<a class="btn btn-warning" asp-action="Edit" asp-route-id="@room.Id">Edit</a>
						</td>
					</tr>
				}
			</tbody>
		</table>
	</div>
	<div class="pagination-area">
		<nav aria-label="Page navigation example">
			<ul class="pagination justify-content-center">
				<!-- Previous Button -->
				@if (ViewBag.CurrentPage > 0)
				{
					<li class="page-item">
						<a class="page-link" asp-action="Index" asp-route-page="@(ViewBag.CurrentPage - 1)" aria-label="Previous">
							<span aria-hidden="true">&laquo;</span>
						</a>
					</li>
				}

				<!-- Page Numbers -->
				@for (int i = 1; i <= ViewBag.MaxPage; i++)
				{
					<li class="page-item @(i == ViewBag.CurrentPage + 1 ? "active" : "")">
						<a class="page-link" asp-action="Index" asp-route-page="@(i - 1)">@i</a>
					</li>
				}

				<!-- Next Button -->
				@if (ViewBag.CurrentPage < ViewBag.MaxPage - 1)
				{
					<li class="page-item">
						<a class="page-link" asp-action="Index" asp-route-page="@(ViewBag.CurrentPage + 1)" aria-label="Next">
							<span aria-hidden="true">&raquo;</span>
						</a>
					</li>
				}
			</ul>
		</nav>
	</div>
</div>




@section styles {
	<link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css" rel="stylesheet" />
}

@section scripts {
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

	<script>
		$(document).ready(function () {
			toastr.options = {
				"closeButton": false,
				"debug": false,
				"newestOnTop": false,
				"progressBar": true,
				"positionClass": "toast-top-right",
				"preventDuplicates": false,
				"onclick": null,
				"showDuration": "300",
				"hideDuration": "1000",
				"timeOut": "5000",
				"extendedTimeOut": "1000",
				"showEasing": "swing",
				"hideEasing": "linear",
				"showMethod": "fadeIn",
				"hideMethod": "fadeOut"
			};

			let deleteBtns = document.querySelectorAll(".delete");

			deleteBtns.forEach(btn => {
				btn.addEventListener("click", (event) => {
					event.preventDefault();

					let categoryId = btn.getAttribute("category-id");

					Swal.fire({
						title: "Are you sure you want to delete?",
						text: "You won't be able to revert this!",
						icon: "warning",
						showCancelButton: true,
						confirmButtonColor: "#d33",
						cancelButtonColor: "#3085d6",
						confirmButtonText: "Yes, delete it!"
					}).then((result) => {
						if (result.isConfirmed) {
							fetch(`/Admin/Room/Delete/${categoryId}`, {
								method: "POST",
								headers: {
									'RequestVerificationToken': $('input[name="__RequestVerificationToken"]').val()
								}
							})
								.then(response => {
									if (response.ok) {
										toastr["success"]("Room deleted successfully");
										btn.closest("tr").remove();
									} else {
										toastr["error"]("Failed to delete Room");
									}
								})
								.catch(error => {
									console.error("Error:", error);
									toastr["error"]("An error occurred while deleting the Room");
								});
						}
					});
				});
			});
		});
	</script>
}